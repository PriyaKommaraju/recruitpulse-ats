<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RecruitPulse ATS</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f8fafc;
    }
    .markdown ul { list-style: disc; padding-left: 1.25rem; }
    .markdown li { margin-bottom: 0.35rem; }
  </style>
</head>

<body class="text-slate-800">
<div id="root"></div>

{% raw %}
<script type="text/babel">
const { useState } = React;

function Markdown({ text }) {
  return (
    <div
      className="markdown text-sm text-slate-700 leading-relaxed"
      dangerouslySetInnerHTML={{ __html: marked.parse(text || "") }}
    />
  );
}

const toMarkdownList = (arr) =>
  arr && arr.length ? arr.map(i => `- ${i}`).join("\n") : "";

function App() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const uploadResume = async (e) => {
    const file = e.target.files[0];
    if (!file || file.type !== "application/pdf") {
      setError("Please upload a valid PDF resume.");
      return;
    }

    setLoading(true);
    setError(null);

    const formData = new FormData();
    formData.append("file", file);

    try {
      const res = await fetch("/api/analyze", {
        method: "POST",
        body: formData
      });

      const result = await res.json();
      setLoading(false);

      if (result.error) setError(result.error);
      else setData(result);

    } catch {
      setLoading(false);
      setError("Server unavailable. Please try again.");
    }
  };

  /* ---------------- UPLOAD SCREEN ---------------- */
  if (!data) {
    return (
      <div className="min-h-screen flex flex-col items-center pt-20 px-6">

        {/* BIGGER + SLIGHTLY TOP-CENTERED HEADING */}
        <h1 className="text-4xl md:text-5xl font-semibold text-indigo-600 tracking-tight">
          RecruitPulse ATS
        </h1>
        <p className="text-sm md:text-base text-slate-500 mt-2 mb-10 text-center max-w-md">
          Resume screening & ATS compatibility analysis
        </p>

        <div className="bg-white rounded-2xl shadow-md p-8 w-full max-w-md text-center">

          {!loading && (
            <>
              <h2 className="text-lg font-semibold text-indigo-600 mb-2">
                Upload Resume
              </h2>
              <p className="text-sm text-slate-500 mb-6">
                Get ATS score and recruiter insights
              </p>

              <input
                type="file"
                accept=".pdf"
                onChange={uploadResume}
                className="file:bg-indigo-600 file:text-white
                           file:px-6 file:py-2.5 file:rounded-full
                           file:border-0 cursor-pointer"
              />
            </>
          )}

          {loading && (
            <div className="flex flex-col items-center gap-4 py-6">
              <div className="w-10 h-10 border-4 border-indigo-200
                              border-t-indigo-600 rounded-full animate-spin"></div>
              <p className="text-sm font-medium text-slate-600">
                Analyzing resumeâ€¦
              </p>
            </div>
          )}

          {error && (
            <p className="mt-4 text-sm text-red-600">
              {error}
            </p>
          )}
        </div>
      </div>
    );
  }

  /* ---------------- RESULTS SCREEN (UNCHANGED) ---------------- */
  return (
    <div className="max-w-7xl mx-auto px-6 py-10">

      <header className="mb-10">
        <h1 className="text-3xl font-semibold text-indigo-600">
          RecruitPulse ATS
        </h1>
        <p className="text-sm text-slate-500">
          Resume screening & ATS compatibility analysis
        </p>
      </header>

      <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">

        {/* LEFT COLUMN */}
        <div className="lg:col-span-4 space-y-6">

          <div className="bg-white rounded-2xl shadow-md p-6">
            <p className="text-xs uppercase text-slate-400">ATS Score</p>
            <p className="text-6xl font-semibold text-indigo-600">
              {data.ats_score}
            </p>

            <div className="mt-6 space-y-4">
              <Score label="Keyword Alignment" value={data.keyword_score} />
              <Score label="ATS Formatting" value={data.formatting_score} />
              <Score label="Technical Match" value={data.technical_score} />
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm p-5">
            <h3 className="text-sm font-semibold text-indigo-600 mb-3">
              Recommended Roles
            </h3>
            <div className="flex flex-wrap gap-2">
              {data.recommended_job_roles.map((role, i) => (
                <span
                  key={i}
                  className="px-3 py-1.5 text-xs rounded-full
                             bg-indigo-50 text-indigo-700"
                >
                  {role}
                </span>
              ))}
            </div>
          </div>

        </div>

        {/* RIGHT COLUMN */}
        <div className="lg:col-span-8 space-y-6">

          <div className="bg-white rounded-2xl shadow-md p-6">
            <h3 className="text-sm font-semibold text-indigo-600
                           border-l-4 border-indigo-600 pl-3 mb-2">
              Recruiter Summary
            </h3>
            <Markdown text={data.overall_summary} />
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div className="bg-white rounded-xl shadow-sm p-6">
              <h4 className="text-sm font-semibold text-indigo-600
                             border-l-4 border-indigo-500 pl-3 mb-2">
                Strengths
              </h4>
              <Markdown text={toMarkdownList(data.strengths)} />
            </div>

            <div className="bg-white rounded-xl shadow-sm p-6">
              <h4 className="text-sm font-semibold text-indigo-600
                             border-l-4 border-indigo-500 pl-3 mb-2">
                ATS Improvements
              </h4>
              <Markdown text={toMarkdownList(data.ats_improvements)} />
            </div>

            <div className="bg-white rounded-xl shadow-sm p-6 md:col-span-2">
              <h4 className="text-sm font-semibold text-indigo-600
                             border-l-4 border-indigo-500 pl-3 mb-2">
                Technical Improvements
              </h4>
              <Markdown text={toMarkdownList(data.technical_improvements)} />
            </div>

          </div>

        </div>

      </div>
    </div>
  );
}

function Score({ label, value }) {
  return (
    <div>
      <div className="flex justify-between text-xs text-slate-600">
        <span>{label}</span>
        <span>{value}%</span>
      </div>
      <div className="w-full bg-slate-200 rounded-full h-1.5 mt-1">
        <div
          className="bg-indigo-600 h-1.5 rounded-full transition-all"
          style={{ width: value + "%" }}
        ></div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
{% endraw %}

</body>
</html>
